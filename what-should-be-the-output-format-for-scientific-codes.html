<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>What should be the output format for scientific codes? &ndash; william-dawson.github.io</title>

    <!-- Meta -->
    <meta name="description" content="william-dawson.github.io &ndash; ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Social -->
    <meta property="article:author" content="William Dawson" />
    <meta property="article:section" content="Lessons" />
    <meta property="article:published_time" content="2017-12-13" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="What should be the output format for scientific codes?"/>
    <meta property="og:description" content="Scientific software needs to print out information during the course of a run. In this post, I will describe three key features that program output should have, and compare various output formats by this rubric."/>
    <meta property="og:site_name" content="william-dawson.github.io" />
    <meta property="og:url" content="https://william-dawson.github.io/what-should-be-the-output-format-for-scientific-codes.html"/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="What should be the output format for scientific codes?">
    <meta name="twitter:description" content="Scientific software needs to print out information during the course of a run. In this post, I will describe three key features that program output should have, and compare various output formats by this rubric.">
    <meta name="twitter:url" content="https://william-dawson.github.io/what-should-be-the-output-format-for-scientific-codes.html">

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" href="https://william-dawson.github.io/feeds/all.atom.xml" title="william-dawson.github.io Atom Feed" />

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:regular,bold">
    <link rel="stylesheet" type="text/css" href="https://william-dawson.github.io/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="https://william-dawson.github.io/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://william-dawson.github.io/theme/css/jqcloud.css">
    <link rel="stylesheet" type="text/css" href="https://william-dawson.github.io/theme/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://william-dawson.github.io/theme/css/pygments-highlight-github.css">

    <!-- Icon -->

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://william-dawson.github.io/theme/js/jqcloud.min.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>

  </head>

  <body>
    <div class="w3-row w3-card w3-white">
      <header id="header">
        <a href="https://william-dawson.github.io" id="header-logo" title="Home">WD</a>
        <nav id="header-menu">
          <ul>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="https://william-dawson.github.io/pages/about.html">About</a></li>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="https://william-dawson.github.io/pages/projects.html">Projects</a></li>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="https://william-dawson.github.io/pages/publications.html">Publications</a></li>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="https://william-dawson.github.io/category/lessons.html">Lessons</a></li>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="https://william-dawson.github.io/category/personal-blog.html">Personal Blog</a></li>
          </ul>
        </nav>
      </header>
    </div>



    <br><br><br>

    <article>
      <header class="w3-container col-main">
        <h1>What should be the output format for scientific codes?</h1>
        <div class="post-info">
          <div class="w3-opacity w3-margin-right w3-margin-bottom" style="flex-grow: 1;">
            <span><time datetime="2017-12-13T11:00:00+09:00">Wed 13 December 2017</time> in <a href="https://william-dawson.github.io/category/lessons.html" title="All articles in category Lessons">Lessons</a></span>
          </div>
          <div>
            <span class="w3-tag w3-light-grey w3-text-green w3-hover-green">
              <a href="https://william-dawson.github.io/tag/software.html" title="All articles with Software tag">#software</a>
            </span>
          </div>
        </div>
      </header>

      <br>


      <div class="col-main w3-container">
        <section id="content">
          <p>Recently, I've been wondering what is the best output format to use for a scientific code. By output, I don't mean just the raw data that you have computed, but instead the real time output to the terminal that happens as you perform the calculation.</p>
<p>For this questions, I came up with three features I would like to see in a program output format.</p>
<ol>
<li>Readable (that is, by a human)</li>
<li>Parsable (that is, by a computer)</li>
<li>Verifiable</li>
</ol>
<p>Of these three, probably <code>Readable</code> is the most important. If we didn't care about humans reading the output, we might as well skip writing to the terminal in the first place. But users want to see that the program is running as expected, and track progress on the calculation. <code>Readable</code> ensures they can do this easily. Most programs you run will focus on having <code>Readable</code> output.</p>
<p>But the program developer can't always anticipate all the data that a user might want from a program. That's why <code>Parsable</code> is important. It should be easily for the user to extract any piece of data about how a calculation was performed and what its results were from the output file.</p>
<p>The least obvious point is <code>Verifiable</code>. Using just the output of a calculation, we would like to be able automatically verify that a calculation was set up correctly, and that it completed the calculation as expected.</p>
<p>Now let's consider some possible output formats and see how they match with my criteria. As an example program, we'll consider the Hotelling's method program from a previous blog post.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">eigsh</span><span class="p">,</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">identity</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">mmread</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">mmread</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">dimension</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">largest_eigenvalue</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;LM&#39;</span><span class="p">,</span>
                           <span class="n">return_eigenvectors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">inverse_mat</span> <span class="o">=</span> <span class="n">matrix</span> <span class="o">*</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">largest_eigenvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">inverse_mat</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">inverse_mat</span> <span class="o">-</span> \
                  <span class="n">inverse_mat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inverse_mat</span><span class="p">))</span>
    <span class="n">norm_value</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">inverse_mat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span> <span class="o">-</span> <span class="n">identity</span><span class="p">(</span><span class="n">dimension</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">norm_value</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="k">break</span>
</code></pre></div>

<h2>Spaghetti Output</h2>
<p>Probably the most common output format is... well no format at all. Let's
imagine what that might look like with our program.</p>
<div class="highlight"><pre><span></span><code><span class="gu">##</span>##########################################################################
/  |      /         / / /                     /|/|      /    /            |
(___| ___ (___  ___ ( (    ___  ___  ___      ( / | ___ (___ (___  ___  ___|
|   )|   )|    |___)| | | |   )|   )|___      |   )|___)|    |   )|   )|   )
|  / |__/ |__  |__  | | | |  / |__/  __/      |  / |__  |__  |  / |__/ |__/
<span class="gu">##</span>##########################################################################
Reading input...
Output read! Input file=S_matrix.mtx
Computing initial guess matrix...
Largest eigenvalue:1.86124928636
Initial guess computed!
Running algorithm
1.57802206403
1.2555463121
0.966656384587
0.652685328614
0.312962675887
0.0782546324211
0.00561087257415
3.11928836745e-05
Program finished, with convergence of: 9.72911618378e-10
Thank you for using our program
</code></pre></div>

<p>Ugly, but at least it's friendly. And of course I couldn't forget the giant ascii header that we've all seen before. This output gives us enough output to know what stage we are at in the calculation, so a user can easily track the progress of the code. We could try to be even more pretty with our output. How about this:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> My Hotelling&#39;s Method Code
Compute a matrix inverse using hotelling&#39;s method

<span class="gu">##</span> Reading input...
Output read! Input file=S_matrix.mtx

<span class="gu">##</span> Computing initial guess matrix...
Largest eigenvalue: 1.86124928636
Initial guess computed!

<span class="gu">##</span> Running algorithm
Iterations
0. 1.57802206403
1. 1.2555463121
2. 0.966656384587
3. 0.652685328614
4. 0.312962675887
5. 0.0782546324211
6. 0.00561087257415
7. 3.11928836745e-05

<span class="gu">##</span> Summary
Program finished, with convergence of: 9.72911618378e-10
Thank you for using our program
</code></pre></div>

<p>That's right, it's markdown. If the text alone isn't easy enough to read, you could easily convert it into an html website even. Maybe I could just run my programs instead of writing blog posts.</p>
<p>So what are the downsides of this approach? Well mainly it is difficult to parse. Not impossible, but you basically have to write a custom parser that knows where in the file all the values you want are. And changes to code could competely break your parser.</p>
<h2>Formatted Output</h2>
<p>Let's consider some alternative formats. First, what about XML:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; ?&gt;</span>
<span class="nt">&lt;Hotelling_Method&gt;</span>
<span class="w">  </span><span class="nt">&lt;message&gt;</span>Compute<span class="w"> </span>a<span class="w"> </span>matrix<span class="w"> </span>inverse<span class="w"> </span>using<span class="w"> </span>Hotelling&#39;s<span class="w"> </span>method<span class="nt">&lt;/message&gt;</span>
<span class="w">  </span><span class="nt">&lt;reading_input&gt;</span>
<span class="w">    </span><span class="nt">&lt;input_file&gt;</span>S_matrix.mtx<span class="nt">&lt;/input_file&gt;</span>
<span class="w">  </span><span class="nt">&lt;/reading_input&gt;</span>
<span class="w">  </span><span class="nt">&lt;initial_guess&gt;</span>
<span class="w">    </span><span class="nt">&lt;largest_eigenvalue&gt;</span>1.86124928636<span class="nt">&lt;/largest_eigenvalue&gt;</span>
<span class="w">  </span><span class="nt">&lt;/initial_guess&gt;</span>
<span class="w">  </span><span class="nt">&lt;run_algorithm&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>1.57802206403<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>1.2555463121<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>0.966656384587<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>0.652685328614<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>0.312962675887<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>0.0782546324211<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>0.00561087257415<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>3.11928836745e-05<span class="nt">&lt;/value&gt;</span>
<span class="w">  </span><span class="nt">&lt;/run_algorithm&gt;</span>
<span class="w">  </span><span class="nt">&lt;summary&gt;</span>
<span class="w">     </span><span class="nt">&lt;convergence&gt;</span>9.72911618378e-10<span class="nt">&lt;/convergence&gt;</span>
<span class="w">     </span><span class="nt">&lt;message&gt;</span>Thank<span class="w"> </span>you<span class="w"> </span>for<span class="w"> </span>using<span class="w"> </span>our<span class="w"> </span>program<span class="nt">&lt;/message&gt;</span>
<span class="w">  </span><span class="nt">&lt;/summary&gt;</span>
<span class="nt">&lt;/Hotelling_Method&gt;</span>
</code></pre></div>

<p>The Qbox[1] electronic structure package, for example, uses XMl. One nice thing about using XML is that there are many libraries that could be used to parse it. Additionally, the tree like organization of XML means a parse can quickly get to the values of interest. But as a downside, this XML can be a little difficult to read for a human.</p>
<p>Currently, I am working on collaborations with the developers of BigDFT[2].
BigDFT's choice of output is YAML:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Hotelling_Method</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">message:&quot;Compute a matrix inverse using Hotelling&#39;s method&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">input</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">input_file:S_matrix.mtx</span>
<span class="w">  </span><span class="nt">initial_guess</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">largest_eigenvalue:1.86124928636</span>
<span class="w">  </span><span class="nt">run_algorithm</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.57802206403</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2555463121</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.966656384587</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.652685328614</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.312962675887</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0782546324211</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00561087257415</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.11928836745e-05</span>
<span class="w">  </span><span class="nt">summary</span><span class="p">:</span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">convergence:9.72911618378e-10</span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">message:&quot;Thank you for using our program&quot;</span>
</code></pre></div>

<p>In my opinion, YAML is less verbose, which makes it much easier for the user to read. And like XML, there are many libraries for parsing YAML automatically. JSON would also make for a nice alternative.</p>
<h2>Verifiable</h2>
<p>The one benefit I see for XML over YAML is the notion of XML schema. Being able to automatically validate the output file can ensure the code remains parsable despite the introduction of new features. Furthermore, schema can help a user get a high level view of where output values are stored.</p>
<p>I would like to go one step further with the concept of verifiable though. One amazing feature about BigDFT, is that every output file is also an input file! That means you should be able to truly verify output by re-running the calculation on the output file. This is a fantastic guard against data tampering. You might hope to go even one step further and have the output file contain all the information about how the program was compiled, and which version of the code was used.</p>
<p>In the future, I hope to apply these principles to my program, and NTPoly of course. Indeed, already it outputs in a YAML format. Unfortunately, I am still struggling with how to make the output printer best interact with the calling program. Perhaps my progress will make for a good future blog post.</p>
<blockquote>
<p>[1] http://www.qboxcode.org/</p>
<p>[2] http://bigdft.org/Wiki/index.php?title=BigDFT_website</p>
</blockquote>
        </section>

        <br><br><br>

 <!--        <footer>
          <div class="adjust-width">
            <div id="author-block" class="w3-light-grey w3-border">
              <div id="author-info">
                <a href=""><img style="width: 60px; height: 60px;" src="" onerror="this.src='images/avatar.png'" alt="Avatar"></a>
                <div style="margin-left: 20px; margin-top: 15px;">
                  <a href=""><span id="author-name" class="w3-hover-text-dark-grey">William Dawson</span></a>
                  <p id="author-story"></p>
                </div>
              </div>
            </div>
          </div>

          <br><br><br>

          <p style="font-size:10pt; font-style: italic;">Did you like this article? Share it with your friends!</p>
          <div id="share" class="share">
            <a href="http://www.facebook.com/sharer.php?u=https%3A//william-dawson.github.io/what-should-be-the-output-format-for-scientific-codes.html&amp;t=william-dawson.github.io%3A%20What%20should%20be%20the%20output%20format%20for%20scientific%20codes%3F" target="_blank" class="w3-btn w3-indigo">
              <i class="fa fa-facebook"></i> <span>Facebook</span>
            </a>
            <a href="http://twitter.com/share?url=https%3A//william-dawson.github.io/what-should-be-the-output-format-for-scientific-codes.html&amp;text=william-dawson.github.io%3A%20What%20should%20be%20the%20output%20format%20for%20scientific%20codes%3F" target="_blank" class="w3-btn w3-blue">
              <i class="fa fa-twitter"></i> <span>Twitter</span>
            </a>
            <a href="https://plus.google.com/share?url=https%3A//william-dawson.github.io/what-should-be-the-output-format-for-scientific-codes.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="w3-btn w3-red">
              <i class="fa fa-google-plus"></i> <span>Google</span>
            </a>
          </div>

          <br><br><br>



        </footer> -->
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-small w3-text-grey w3-padding-48">
        <span>&copy;  William Dawson  | <a href="https://william-dawson.github.io/feeds/all.atom.xml">Atom feed <i class="fa fa-rss" aria-hidden="true"></i></a></span>
      </div>
    </footer>



  </body>
</html>